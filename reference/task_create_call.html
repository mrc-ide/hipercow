<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create task from call — task_create_call • hipercow</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Create task from call — task_create_call"><meta name="description" content="Create a task based on a function call.  This is fairly similar to
callr::r, and forms the basis of lapply()-like task
submission.  Sending a call may have slightly different semantics
than you expect if you send a closure (a function that binds
data), and we may change behaviour here until we find a happy set
of compromises.  See Details for more on this.  The expression
task_create_call(f, list(a, b, c)) is similar to
task_create_expr(f(a, b, c)), use whichever you prefer."><meta property="og:description" content="Create a task based on a function call.  This is fairly similar to
callr::r, and forms the basis of lapply()-like task
submission.  Sending a call may have slightly different semantics
than you expect if you send a closure (a function that binds
data), and we may change behaviour here until we find a happy set
of compromises.  See Details for more on this.  The expression
task_create_call(f, list(a, b, c)) is similar to
task_create_expr(f(a, b, c)), use whichever you prefer."><meta property="og:image" content="https://mrc-ide.github.io/hipercow/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hipercow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/hipercow.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>General</h6></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Packages and provisioning</a></li>
    <li><a class="dropdown-item" href="../articles/parallel.html">Parallel Tasks</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
    <li><a class="dropdown-item" href="../articles/environments.html">Environments</a></li>
    <li><a class="dropdown-item" href="../articles/stan.html">Using stan</a></li>
    <li><a class="dropdown-item" href="../articles/INLA.html">Using INLA on Windows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clusters</h6></li>
    <li><a class="dropdown-item" href="../articles/dide-cluster.html">The DIDE Cluster</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/workers.html">Workers</a></li>
    <li><a class="dropdown-item" href="../articles/administration.html">Administration</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from didehpc</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/hipercow/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create task from call</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/hipercow/blob/main/R/task-create.R" class="external-link"><code>R/task-create.R</code></a></small>
      <div class="d-none name"><code>task_create_call.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a task based on a function call.  This is fairly similar to
<a href="https://callr.r-lib.org/reference/r.html" class="external-link">callr::r</a>, and forms the basis of <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>-like task
submission.  Sending a call may have slightly different semantics
than you expect if you send a closure (a function that binds
data), and we may change behaviour here until we find a happy set
of compromises.  See Details for more on this.  The expression
<code>task_create_call(f, list(a, b, c))</code> is similar to
<code>task_create_expr(f(a, b, c))</code>, use whichever you prefer.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">task_create_call</span><span class="op">(</span></span>
<span>  <span class="va">fn</span>,</span>
<span>  <span class="va">args</span>,</span>
<span>  environment <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  driver <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  resources <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  envvars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  root <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-fn">fn<a class="anchor" aria-label="anchor" href="#arg-fn"></a></dt>
<dd><p>The function to call.</p></dd>


<dt id="arg-args">args<a class="anchor" aria-label="anchor" href="#arg-args"></a></dt>
<dd><p>A list of arguments to pass to the function</p></dd>


<dt id="arg-environment">environment<a class="anchor" aria-label="anchor" href="#arg-environment"></a></dt>
<dd><p>Name of the hipercow environment to evaluate the
task within.</p></dd>


<dt id="arg-driver">driver<a class="anchor" aria-label="anchor" href="#arg-driver"></a></dt>
<dd><p>Name of the driver to use to submit the task.  The
default (<code>NULL</code>) depends on your configured drivers; if you have
no drivers configured no submission happens (or indeed is
possible).  If you have exactly one driver configured we'll
submit your task with it.  If you have more than one driver
configured, then we will error, though in future versions we may
fall back on a default driver if you have one configured.  If
you pass <code>FALSE</code> here, submission is prevented even if you have
no driver configured.</p></dd>


<dt id="arg-resources">resources<a class="anchor" aria-label="anchor" href="#arg-resources"></a></dt>
<dd><p>A list generated by <a href="hipercow_resources.html">hipercow_resources</a> giving
the cluster resource requirements to run your task.</p></dd>


<dt id="arg-envvars">envvars<a class="anchor" aria-label="anchor" href="#arg-envvars"></a></dt>
<dd><p>Environment variables as generated by
<a href="hipercow_envvars.html">hipercow_envvars</a>, which you might use to control your task.
These will be combined with the default environment variables
(see <code>vignettes("details")</code>, this can be overridden by the
option <code>hipercow.default_envvars</code>), and any driver-specific
environment variables (see <code>vignette("windows")</code>).  Variables
provided here have the highest precedence.  You can <strong>unset</strong> an
environment variable by setting it to <code>NA</code>.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Parallel configuration as generated by
<a href="hipercow_parallel.html">hipercow_parallel</a>, which defines which method, if any, will be used
to initialise your task for parallel execution.</p></dd>


<dt id="arg-root">root<a class="anchor" aria-label="anchor" href="#arg-root"></a></dt>
<dd><p>A hipercow root, or path to it. If <code>NULL</code> we search up
your directory tree.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A task id, a string of hex characters. Use this to
interact with the task.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Things are pretty unambiguous when you pass in a function from a
package, especially when you refer to that package with its
namespace (e.g. <code>pkg::fn</code>).</p>
<p>If you pass in the name <em>without a namespace</em> from a package that
you have loaded with <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> locally but you have not loaded
with <code>library</code> within your hipercow environment, we may not do the
right thing and you may see your task fail, or find a different
function with the same name.  We may change the semantics here in
a future version to attach your package immediately before running
the task.</p>
<p>If you pass in an anonymous function (e.g., <code>function(x) x + 1</code>)
we may or may not do the right thing with respect to environment
capture.  We never capture the global environment so if your
function is a closure that tries to bind a symbol from the global
environment it will not work.  Like with <code><a href="https://callr.r-lib.org/reference/r.html" class="external-link">callr::r</a></code>, anonymous
functions will be easiest to think about where they are fully self
contained (i.e., all inputs to the functions come through <code>args</code>).
If you have bound a <em>local</em> environment, we may do slightly
better, but semantics here are undefined and subject to change.</p>
<p>R does some fancy things with function calls that we don't try to
replicate.  In particular you may have noticed that this works:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="st">"x"</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">c</span>(c, c) <span class="co"># a vector of two "x"'s</span></span></code></pre><p></p></div>
<p>You can end up in this situation locally with:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="fu">f</span>(f) <span class="co"># 2</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>})</span></code></pre><p></p></div>
<p>this is because when R looks for the symbol for the call it skips
over non-function objects.  We don't reconstruct environment
chains in exactly the same way as you would have locally so this
is not possible.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">cleanup</span> <span class="op">&lt;-</span> <span class="fu"><a href="hipercow_example_helper.html">hipercow_example_helper</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> This example uses a special helper</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Similar to the example in task_create_call</span></span></span>
<span class="r-in"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu">task_create_call</span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Submitted task '0a8b121f077bd0d28298eae0429c1038' using 'example'</span>
<span class="r-in"><span><span class="fu"><a href="task_info.html">task_info</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">task 0a8b121f077bd0d28298eae0429c1038 (submitted)</span> <span style="color: #00BBBB;">───────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Submitted with 'example'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Task type: call</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   • Call: stats::runif</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   • Args: 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   • Environment: default</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     R_GC_MEM_GROW: 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Created at 2025-05-13 06:43:57.381169 (moments ago)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Not started yet (waiting for 66ms)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Not finished yet (waiting to start)</span>
<span class="r-in"><span><span class="fu"><a href="task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="task_result.html">task_result</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.21784860 0.46579865 0.39692911 0.04411139 0.17253155</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Unlike task_create_explicit, variables are automatically included:</span></span></span>
<span class="r-in"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu">task_create_call</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Submitted task 'c26372bbcbd7ac4010bd89120162bbbe' using 'example'</span>
<span class="r-in"><span><span class="fu"><a href="task_info.html">task_info</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">task c26372bbcbd7ac4010bd89120162bbbe (submitted)</span> <span style="color: #00BBBB;">───────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Submitted with 'example'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Task type: call</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   • Call: (anonymous)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   • Args: 2, 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   • Environment: default</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     R_GC_MEM_GROW: 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Created at 2025-05-13 06:43:58.462183 (moments ago)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Started at 2025-05-13 06:43:58.669851 (moments ago; waited 208ms)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Not finished yet (waiting to start)</span>
<span class="r-in"><span><span class="fu"><a href="task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="task_result.html">task_result</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 7</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cleanup</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Cleaning up example</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Paul Liétar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

