<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Specify parallel use of cores — hipercow_parallel • hipercow</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Specify parallel use of cores — hipercow_parallel"><meta name="description" content="Set parallel options.  Having requested more than one core using
hipercow_resources, here hipercow can start up a local cluster
on the node you are running on, using either the future or
parallel package."><meta property="og:description" content="Set parallel options.  Having requested more than one core using
hipercow_resources, here hipercow can start up a local cluster
on the node you are running on, using either the future or
parallel package."><meta property="og:image" content="https://mrc-ide.github.io/hipercow/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hipercow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/hipercow.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>General</h6></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Packages and provisioning</a></li>
    <li><a class="dropdown-item" href="../articles/parallel.html">Parallel Tasks</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
    <li><a class="dropdown-item" href="../articles/environments.html">Environments</a></li>
    <li><a class="dropdown-item" href="../articles/secrets.html">Using secrets on the cluster</a></li>
    <li><a class="dropdown-item" href="../articles/stan.html">Using stan</a></li>
    <li><a class="dropdown-item" href="../articles/INLA.html">Using INLA on Windows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clusters</h6></li>
    <li><a class="dropdown-item" href="../articles/dide-cluster.html">The DIDE Cluster</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/workers.html">Workers</a></li>
    <li><a class="dropdown-item" href="../articles/administration.html">Administration</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from didehpc</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/hipercow/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Specify parallel use of cores</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/hipercow/blob/main/R/parallel.R" class="external-link"><code>R/parallel.R</code></a></small>
      <div class="d-none name"><code>hipercow_parallel.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Set parallel options.  Having requested more than one core using
<a href="hipercow_resources.html">hipercow_resources</a>, here hipercow can start up a local cluster
on the node you are running on, using either the <code>future</code> or
<code>parallel</code> package.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hipercow_parallel</span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cores_per_process <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  environment <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_rrq <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>The parallel method that hipercow will prepare.
Three options are available: the <code>future</code> package, the <code>parallel</code>
package, or <code>NULL</code>, the default, will do nothing. See the details for
examples.</p></dd>


<dt id="arg-cores-per-process">cores_per_process<a class="anchor" aria-label="anchor" href="#arg-cores-per-process"></a></dt>
<dd><p>The number of cores allocated to each
process when launching a local cluster using one of the parallel
methods. By default, this will be <code>1</code>. See details.</p></dd>


<dt id="arg-environment">environment<a class="anchor" aria-label="anchor" href="#arg-environment"></a></dt>
<dd><p>The name of the environment to load into your
parallel workers.  The default is to use the environment that
you submit your task with (which defaults to <code>default</code>), which
means that each worker gets the same environment as your main
process.  This is often what you want, but can mean that you
load too much into each worker and incur a speed or memory
cost.  In that case you may want to create a new environment
(<a href="hipercow_environment.html">hipercow_environment_create</a>) that contains fewer packages or
sources fewer functions and specify that here. If you want to
suppress loading any packages into the workers you can use the
<code>empty</code> environment, which always exists.</p></dd>


<dt id="arg-use-rrq">use_rrq<a class="anchor" aria-label="anchor" href="#arg-use-rrq"></a></dt>
<dd><p>Logical, indicating if you intend to use
<code>rrq</code>-based workers from your tasks, in which case we will set a
default controller.  Enabling this requires that you have
configured a rrq controller via <code><a href="hipercow_rrq_controller.html">hipercow_rrq_controller()</a></code>
before submitting the task (we check this before submission) and
that you have submitted some workers via
<code><a href="hipercow_rrq_workers_submit.html">hipercow_rrq_workers_submit()</a></code> (we don't check this because you
will want them running at the time that your task starts, so you
may want to launch them later depending on your workflow.  We'll
document this more in <code>vignete("rrq")</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing your parallel configuration.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Here, hipercow automatically does some setup work for the
supported methods, to initialise a local cluster of processes
that can be used with <code>future_map</code> or <code>clusterApply</code>,
depending on your method.</p>
<p>By default, hipercow initialises a cluster with the same number
of processes as the number of cores you requested using
<code>hipercow_resources</code>. Each process here would be use a single core.</p>
<p>You can also call <code>hipercow_parallel</code> with <code>cores_per_process</code>,
to make hipercow launch as many processes as it can with
each process having the number of cores you request, with
the total cores being at most what you requested with
<code>hipercow_resources</code>.</p>
<p>For example, you could request 32 cores with <code>hipercow_resources</code>,
and then call <code>hipercow_parallel</code> with <code>cores_per_process = 4</code>,
and hipercow will create a local cluster with 8 processes, each
of which reporting <code>4</code> cores if that process calls
<code>hipercow_parallel_get_cores</code>.</p>
<p>If you did the same with <code>cores_per_process = 5</code>, hipercow would
create 6 local processes, each reporting <code>5</code> cores, and
two cores would be effectively unallocated.</p>
<p>Here are some brief examples; see <code><a href="../articles/parallel.html">vignette("parallel")</a></code> for more
details. In each example, we are looking up the process id (to
show that different processes are being launched), and asking each
process how many cores it should be using.</p>
<p>For using the <code>future</code> package:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>resources <span class="ot">&lt;-</span> <span class="fu">hipercow_resources</span>(<span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">task_create_expr</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  furrr<span class="sc">::</span><span class="fu">future_map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">c</span>(<span class="fu">Sys.getpid</span>(), <span class="fu">hipercow_parallel_get_cores</span>()),</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="at">parallel =</span> <span class="fu">hipercow_parallel</span>(<span class="st">"future"</span>),</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">resources =</span> resources)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span></code></pre><p></p></div>
<p>where <code>furrr</code> must be provisioned using <a href="hipercow_provision.html">hipercow_provision</a>.
Here is an equivalent example with <code>parallel</code>:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>resources <span class="ot">&lt;-</span> <span class="fu">hipercow_resources</span>(<span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">task_create_expr</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  parallel<span class="sc">::</span><span class="fu">clusterApply</span>(<span class="cn">NULL</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(x)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="fu">c</span>(<span class="fu">Sys.getpid</span>(), <span class="fu">hipercow_parallel_get_cores</span>()),</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="at">parallel =</span> <span class="fu">hipercow_parallel</span>(<span class="st">"parallel"</span>),</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">resources =</span> resources)</span></code></pre><p></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Paul Liétar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

