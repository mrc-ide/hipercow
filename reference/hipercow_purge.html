<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Purge tasks — hipercow_purge • hipercow</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Purge tasks — hipercow_purge"><meta name="description" content="Purge (delete) hipercow tasks.  This is a destructive operation
that cannot be undone and can have unintended consequences!
However, if you are running short of space and don't want to just
delete everything and start again (which is our general
recommendation), this function provides a mechanism for cleaning
up tasks that you no longer need."><meta property="og:description" content="Purge (delete) hipercow tasks.  This is a destructive operation
that cannot be undone and can have unintended consequences!
However, if you are running short of space and don't want to just
delete everything and start again (which is our general
recommendation), this function provides a mechanism for cleaning
up tasks that you no longer need."><meta property="og:image" content="https://mrc-ide.github.io/hipercow/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hipercow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/hipercow.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>General</h6></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Packages and provisioning</a></li>
    <li><a class="dropdown-item" href="../articles/parallel.html">Parallel Tasks</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
    <li><a class="dropdown-item" href="../articles/environments.html">Environments</a></li>
    <li><a class="dropdown-item" href="../articles/secrets.html">Using secrets on the cluster</a></li>
    <li><a class="dropdown-item" href="../articles/stan.html">Using stan</a></li>
    <li><a class="dropdown-item" href="../articles/INLA.html">Using INLA on Windows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clusters</h6></li>
    <li><a class="dropdown-item" href="../articles/dide-cluster.html">The DIDE Cluster</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/workers.html">Workers</a></li>
    <li><a class="dropdown-item" href="../articles/administration.html">Administration</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from didehpc</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/hipercow/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Purge tasks</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/hipercow/blob/main/R/task-purge.R" class="external-link"><code>R/task-purge.R</code></a></small>
      <div class="d-none name"><code>hipercow_purge.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Purge (delete) hipercow tasks.  This is a destructive operation
that cannot be undone and can have unintended consequences!
However, if you are running short of space and don't want to just
delete everything and start again (which is our general
recommendation), this function provides a mechanism for cleaning
up tasks that you no longer need.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hipercow_purge</span><span class="op">(</span></span>
<span>  task_ids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  finished_before <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  in_bundle <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  with_status <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dry_run <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  root <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-task-ids">task_ids<a class="anchor" aria-label="anchor" href="#arg-task-ids"></a></dt>
<dd><p>A character vector of task identifiers.  Typically
if you provide this you will not provide any other filters.</p></dd>


<dt id="arg-finished-before">finished_before<a class="anchor" aria-label="anchor" href="#arg-finished-before"></a></dt>
<dd><p>A date, time, or <a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a> object
representing the time or time ago that a task finished (here,
the job might have finished for any reason; successfully or
unsuccessfully unless you also provide the <code>with_status</code>
argument).  Everything prior to this will be deleted.</p></dd>


<dt id="arg-in-bundle">in_bundle<a class="anchor" aria-label="anchor" href="#arg-in-bundle"></a></dt>
<dd><p>A character vector of bundle names. Wild cards
are supported using shell (glob) syntax, rather than regular
expression syntax.  So use <code>data_*</code> to match all bundles that
start with <code>data_</code> (see <a href="https://rdrr.io/r/utils/glob2rx.html" class="external-link">utils::glob2rx</a> for details).  It is an error
if <em>no</em> bundles are matched, but not an error if any individual
pattern does not match.</p></dd>


<dt id="arg-with-status">with_status<a class="anchor" aria-label="anchor" href="#arg-with-status"></a></dt>
<dd><p>A character vector of statuses to match.  We
only purge tasks that match these statuses.  Valid statuses to
use are <code>created</code>, <code>success</code>, <code>failure</code> and <code>cancelled</code> (note
you cannot select tasks with status of <code>submitted</code> or <code>running</code>;
use <a href="task_cancel.html">task_cancel</a> for these first).</p></dd>


<dt id="arg-dry-run">dry_run<a class="anchor" aria-label="anchor" href="#arg-dry-run"></a></dt>
<dd><p>If TRUE, report what would have been done, but
no changes will be made.</p></dd>


<dt id="arg-root">root<a class="anchor" aria-label="anchor" href="#arg-root"></a></dt>
<dd><p>A hipercow root, or path to it. If <code>NULL</code> we search up
your directory tree.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A character vector of deleted identifiers, invisibly.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Most of the arguments describe <em>filters</em> over your tasks.  We
delete the intersection of these filters (not the union), and you
must provide at least one filter.  So to delete all tasks that
were created more than a week ago you could write:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">hipercow_purge</span>(<span class="at">created_before =</span> <span class="fu">as.difftime</span>(<span class="dv">1</span>, <span class="at">units =</span> <span class="st">"weeks"</span>))</span></code></pre><p></p></div>
<p>but to restrict this to only tasks that have <em>also failed</em> you
could write</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">hipercow_purge</span>(<span class="at">created_before =</span> <span class="st">"1 week"</span>, <span class="at">with_status =</span> <span class="st">"failed"</span>)</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="consequences-of-deletion">Consequences of deletion<a class="anchor" aria-label="anchor" href="#consequences-of-deletion"></a></h2>
    <p>A non-exhaustive list:</p><ul><li><p>If you delete a task that is part of a <a href="task_retry.html">task_retry</a> chain, then
all tasks (both upstream and downstream in that chain) are
deleted</p></li>
<li><p>Once we support task dependencies (mrc-4797), deleting tasks
will mark any not-yet-run dependent task as impossible, or perhaps
delete it too, or prevent you from deleting the task; we've not
decided yet</p></li>
<li><p>You may have a bundle that references a task that you delete, in
which case the bundle will not behave as expected.  As a result
we delete all bundles that reference a deleted task</p></li>
<li><p>Deleted bundles or deleted tasks that you hold identifiers to
before deletion will not behave as expected, with tasks reported
missing.  Restarting your session is probably the safest thing
to do after purging.</p></li>
<li><p>We can't prevent race conditions, so if you are purging tasks at
the same time you are also retrying tasks that you will purge,
you'll create tasks that we might not want to allow, and these
tasks will fail in peculiar ways.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">cleanup</span> <span class="op">&lt;-</span> <span class="fu"><a href="hipercow_example_helper.html">hipercow_example_helper</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> This example uses a special helper</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Here are some tasks that have finished running:</span></span></span>
<span class="r-in"><span><span class="va">bundle</span> <span class="op">&lt;-</span> <span class="fu"><a href="task_create_bulk_expr.html">task_create_bulk_expr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                bundle_name <span class="op">=</span> <span class="st">"mybundle"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Submitted 5 tasks using 'example'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Created bundle 'mybundle' with 5 tasks</span>
<span class="r-in"><span><span class="fu"><a href="hipercow_bundle_wait.html">hipercow_bundle_wait</a></span><span class="op">(</span><span class="va">bundle</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Purge all tasks contained in any bundle starting with "my":</span></span></span>
<span class="r-in"><span><span class="fu">hipercow_purge</span><span class="op">(</span>in_bundle <span class="op">=</span> <span class="st">"my*"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Purging 5 tasks</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Deleting 1 task bundle</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cleanup</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Cleaning up example</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Paul Liétar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

