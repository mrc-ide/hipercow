<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using stan • hipercow</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Using stan">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hipercow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/hipercow.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>General</h6></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Packages and provisioning</a></li>
    <li><a class="dropdown-item" href="../articles/parallel.html">Parallel Tasks</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
    <li><a class="dropdown-item" href="../articles/environments.html">Environments</a></li>
    <li><a class="dropdown-item" href="../articles/secrets.html">Using secrets on the cluster</a></li>
    <li><a class="dropdown-item" href="../articles/stan.html">Using stan</a></li>
    <li><a class="dropdown-item" href="../articles/INLA.html">Using INLA on Windows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clusters</h6></li>
    <li><a class="dropdown-item" href="../articles/dide-cluster.html">The DIDE Cluster</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/workers.html">Workers</a></li>
    <li><a class="dropdown-item" href="../articles/administration.html">Administration</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from didehpc</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/hipercow/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using stan</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/hipercow/blob/main/vignettes/stan.Rmd" class="external-link"><code>vignettes/stan.Rmd</code></a></small>
      <div class="d-none name"><code>stan.Rmd</code></div>
    </div>

    
    
<!-- Please edit the file in vignettes_src/ -->
<p><a href="https://mc-stan.org/" class="external-link">Stan</a> is a platform for statistical
modelling, using state-of-the art algorithms. Unfortunately, it is very
peculiar about how it needs things installed, and more unfortunately it
plays poorly with other packages and they change their minds about how
to install things every few versions. If you have having trouble getting
your compilers working with stan, rest assured you are in good company
any have been so for a decade or so!</p>
<p>This vignette outlines some survival guides for using stan on the
cluster. They will likely stop working at some point in the future;
please let us know when this happens and we can explore what the current
recommended way of doing things has changed to, if there is one.</p>
<div class="section level2">
<h2 id="local-installations">Local installations<a class="anchor" aria-label="anchor" href="#local-installations"></a>
</h2>
<p>The <code>rstan</code> package is available on CRAN but has
historically lagged releases that are available directly from the stan
developers.</p>
<p>You can install <code>rstan</code> from CRAN but
<code>cmdstanr</code> needs to be installed from the stan repo. At the
time of writing, here are links to the official documentation:</p>
<ul>
<li><a href="https://github.com/stan-dev/rstan/wiki/RStan-Getting-Started" class="external-link">rstan</a></li>
<li><a href="https://mc-stan.org/cmdstanr/articles/cmdstanr.html" class="external-link">cmdstanr</a></li>
</ul>
<p>You will need to install a suitable C++ toolchain. Please refer to
the stan docs above for details on this, and be aware that information
found on StackOverflow or the stan discussion forums is often out of
date. You usually need a moderately recent version of R, too.</p>
</div>
<div class="section level2">
<h2 id="cmdstan-on-the-cluster">CmdStan on the cluster<a class="anchor" aria-label="anchor" href="#cmdstan-on-the-cluster"></a>
</h2>
<p>The <code>CmdStan</code> interface compiles stan programs into
standalone executables, and somewhat isolates stan from the Rtools
toolchain. This is a newer approach than using <code>rstan</code>. There
are two parts here; the <code>cmdstanr</code> R package and the
<code>CmdStan</code> executables.</p>
<div class="section level3">
<h3 id="installation-and-versions">Installation and versions<a class="anchor" aria-label="anchor" href="#installation-and-versions"></a>
</h3>
<p>The version of the package that you use on your own machine is not
important to these instructions (though it may be important to you
depending on what model you are compiling). On the cluster, you need to
install a very recent version of <code>cmdstanr</code> (0.8.1 or newer,
released on 6 June 2024), which is available from the stan
repositories.</p>
<p>Your <code>pkgdepends.txt</code> should contain:</p>
<pre><code>repo::https://stan-dev.r-universe.dev
cmdstanr</code></pre>
<p>(Be sure not to use the <code>https://mc-stan.org/r-packages</code>
repo, still widely noted in documentation as that ships only older
versions, all of which are broken.)</p>
<p>We currently support <code>CmdStan</code> version <code>2.35.0</code>
- we would like to support multiple versions at once, but the internal
gymnastics in <code>cmdstanr</code> make that quite hard to do. Please
let us know if you need a specific version different to whatever we have
installed, and we will install it and update these instructions so that
you can select it.</p>
<p>It is easy to make a mess on the cluster by following instructions
from the stan developers which assume you are the only user of a
machine, and that stan is the main piece of software you are interested
in running. This is especially the case if you follow instructions found
on StackOverflow as these may refer to previous versions. The fallout
should be restricted to your own working space though.</p>
<p>Within a <code>hipercow</code> task, please do not run:</p>
<ul>
<li>
<code>cmdstanr::install_cmdstan</code>: this will install over 1GB
of small files onto the network shares. If you need a specific version
please let us know and we will make one available</li>
<li>
<code>cmdstanr::check_cmdstan_toolchain(fix = TRUE)</code>: this
will do all sorts of damage, up to and including corrupting the Rtools
installation that you need to install packages</li>
</ul>
</div>
<div class="section level3">
<h3 id="compiling-models">Compiling models<a class="anchor" aria-label="anchor" href="#compiling-models"></a>
</h3>
<p>When you use <code>cmdstandr::cmdstan_model()</code> it will generate
a file in the same directory as your <code>.stan</code> file. This is
fine when on your laptop, but is a poor choice in almost any other
context, and especially when you might submit more than one job at a
time (which, given you are using a cluster, you probably are).</p>
<p>You’ll need to pass in a path as the <code>dir</code> to every call
to <code>cmdstanr::cmdstan_model()</code> - unfortunately there’s no way
of doing this automatically. So rather than</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span><span class="st">"model.stan"</span><span class="op">)</span></span></code></pre></div>
<p>you can use</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span><span class="st">"model.stan"</span>, dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Using <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code> guarantees that every process that
starts up will be use a different directory, so you won’t have to think
about this very much.</p>
<p>The two issues being mitigated here are:</p>
<ul>
<li>if the toolchain used to compile stan models differs on your laptop
and the cluster (this is true if you are using a different operating
system, minor version of R, or if you have a different version of
Rtools, or if you have a different version of cmdstanr) then the model
that you have compiled on your machine will not work on the cluster,
with perhaps difficult-to-diagnose errors.</li>
<li>if you launch two or more tasks at once from the cluster, then every
job will try and compile the model at the same time, and then try and
write to the same file. At most one of these tasks will succeed, with
the others failing due to permissions issues (windows cannot write a
file that is open).</li>
</ul>
<p>The (potentially large) downside of using <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code> is
that every time you start a task that uses a stan program it will have
to compile it. Even for a simple program this is quite slow (say up to
two minutes for a “hello world” type problem). Before deciding if this
is going to cause you issues, think about how long it will take to
<em>run</em> your code. If it’s going to run for an hour, then this
delay may be tolerable.</p>
<p>However, if your program is very fast once compiled, this might
become a significant issue. If you want to reuse the models then you
need to do so in a way that (a) only <code>hipercow</code> tasks reuse
the compiled models and (b) no task tries to recompile the model after
it is created. You might explore something like first submitting a task
that runs</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span><span class="st">"model.stan"</span>, dir <span class="op">=</span> <span class="st">"models-hipercow"</span><span class="op">)</span></span></code></pre></div>
<p>(after creating the <code>models-hipercow</code> directory, as stan
will error if it does not yet exist, and won’t create it for you). Then
after that task completes successfully submitting a series of tasks that
use the model. These would include the same exact statement as above to
load the model.</p>
<p>There appears to be no mechanism to either prevent compilation (you
can pass <code>compile = FALSE</code> but the model is then unusable,
even if it has been compiled), or to test to see if the model is up to
date. You can <em>probably</em> get away with this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmdstan_model_but_dont_recompile</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span>, <span class="va">dir</span> <span class="op">=</span> <span class="st">"."</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">path_exe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">".exe"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">is_current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">path_exe</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">path_exe</span><span class="op">)</span><span class="op">$</span><span class="va">mtime</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">$</span><span class="va">mtime</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">is_current</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"stan model '%s' at '%s' is out of date!"</span>,</span>
<span>                 <span class="va">path</span>, <span class="va">dir</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span><span class="va">path</span>, exe_file <span class="op">=</span> <span class="cn">NULL</span>, compile <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          dir <span class="op">=</span> <span class="va">dir</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>which you can use in place of <code>cmdstanr::cmdstan_model</code>,
though this will not behave as expected for models that include other
files. Good luck.</p>
</div>
<div class="section level3">
<h3 id="a-worked-example">A worked example<a class="anchor" aria-label="anchor" href="#a-worked-example"></a>
</h3>
<p>This example is designed partly so we can test everything works, but
we may ask you to run this yourselves if you are having difficulty.</p>
<p>Start with a basic <code>hipercow</code> on Windows setup:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrc-ide/hipercow" class="external-link">hipercow</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/hipercow_init.html">hipercow_init</a></span><span class="op">(</span>driver <span class="op">=</span> <span class="st">"dide-windows"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Initialised hipercow at '.'</span></span>
<span><span class="co">#&gt; ✔ Configured hipercow to use 'dide-windows'</span></span></code></pre></div>
<p>We have a simple stan model <code>code.stan</code>:</p>
<pre><code>data {
  int&lt;lower=0&gt; N;
  array[N] int&lt;lower=0, upper=1&gt; y;
}
parameters {
  real&lt;lower=0, upper=1&gt; theta;
}
model {
  theta ~ beta(1, 5); // uniform prior on interval 0,1
  y ~ bernoulli(theta);
}</code></pre>
<p>And a little wrapper around this, in <code>code.R</code>, which
compiles the model and draws some samples:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_stan</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span><span class="st">'code.stan'</span>, dir <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span>  <span class="va">stan_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">fit_mcmc</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">stan_data</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>    chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We need to add our <code>code.R</code> into the default
environment:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_environment.html">hipercow_environment_create</a></span><span class="op">(</span>sources <span class="op">=</span> <span class="st">"code.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Created environment 'default'</span></span></code></pre></div>
<p>Our <code>provision.txt</code> is as above:</p>
<pre><code>repo::https://stan-dev.r-universe.dev
cmdstanr</code></pre>
<p>Install everything with <code>hipercow_provision</code> as usual</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision.html">hipercow_provision</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Looking for active tasks before installation</span></span>
<span><span class="co">#&gt; ✔ No tasks running</span></span>
<span><span class="co">#&gt; ✔ Selected provisioning method 'pkgdepends'</span></span>
<span><span class="co">#&gt; /`-'\  _______  ___  ___ ____</span></span>
<span><span class="co">#&gt; \,T./ / __/ _ \/ _ \/ _ `/ _ \</span></span>
<span><span class="co">#&gt;   |   \__/\___/_//_/\_,_/_//_/</span></span>
<span><span class="co">#&gt;   |   ---- THE  LIBRARIAN ----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bootstrapping from: I:/bootstrap/4.4.0</span></span>
<span><span class="co">#&gt; Installing into library: hipercow/lib/windows/4.4.0</span></span>
<span><span class="co">#&gt; Using method pkgdepends</span></span>
<span><span class="co">#&gt; Running in path: V:/cluster/hipercow-vignette/hv-20240612-15d41827525afc</span></span>
<span><span class="co">#&gt; Library paths:</span></span>
<span><span class="co">#&gt;   - V:/cluster/hipercow-vignette/hv-20240612-15d41827525afc/hipercow/lib/windows/4.4.0</span></span>
<span><span class="co">#&gt;   - C:/Program Files/R/R-4.4.0/library</span></span>
<span><span class="co">#&gt; id: 20240612125140</span></span>
<span><span class="co">#&gt; Logs from pkgdepends follow:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── repos </span></span>
<span><span class="co">#&gt; • https://stan-dev.r-universe.dev</span></span>
<span><span class="co">#&gt; • https://cloud.r-project.org</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── refs </span></span>
<span><span class="co">#&gt; • cmdstanr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✔ Updated metadata database: 3.15 MB in 6 files.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Updating metadata database</span></span>
<span><span class="co">#&gt; ✔ Updating metadata database ... done</span></span>
<span><span class="co">#&gt; + abind            1.4-5      </span></span>
<span><span class="co">#&gt; + backports        1.5.0      </span></span>
<span><span class="co">#&gt; + checkmate        2.3.1      </span></span>
<span><span class="co">#&gt; + cli              3.6.2      </span></span>
<span><span class="co">#&gt; + cmdstanr         0.8.1      </span></span>
<span><span class="co">#&gt; + data.table       1.15.4     </span></span>
<span><span class="co">#&gt; + distributional   0.4.0      </span></span>
<span><span class="co">#&gt; + fansi            1.0.6      </span></span>
<span><span class="co">#&gt; + generics         0.1.3      </span></span>
<span><span class="co">#&gt; + glue             1.7.0      </span></span>
<span><span class="co">#&gt; + jsonlite         1.8.8      </span></span>
<span><span class="co">#&gt; + lifecycle        1.0.4      </span></span>
<span><span class="co">#&gt; + magrittr         2.0.3      </span></span>
<span><span class="co">#&gt; + matrixStats      1.3.0      </span></span>
<span><span class="co">#&gt; + numDeriv         2016.8-1.1 </span></span>
<span><span class="co">#&gt; + pillar           1.9.0      </span></span>
<span><span class="co">#&gt; + pkgconfig        2.0.3      </span></span>
<span><span class="co">#&gt; + posterior        1.5.0.9000 </span></span>
<span><span class="co">#&gt; + processx         3.8.4      </span></span>
<span><span class="co">#&gt; + ps               1.7.6      </span></span>
<span><span class="co">#&gt; + R6               2.5.1      </span></span>
<span><span class="co">#&gt; + rlang            1.1.4      </span></span>
<span><span class="co">#&gt; + tensorA          0.36.2.1   </span></span>
<span><span class="co">#&gt; + tibble           3.2.1      </span></span>
<span><span class="co">#&gt; + utf8             1.2.4      </span></span>
<span><span class="co">#&gt; + vctrs            0.6.5      </span></span>
<span><span class="co">#&gt; + withr            3.0.0      </span></span>
<span><span class="co">#&gt; ℹ No downloads are needed, 27 pkgs are cached</span></span>
<span><span class="co">#&gt; ✔ Got checkmate 2.3.1 (x86_64-w64-mingw32) (746.60 kB)</span></span>
<span><span class="co">#&gt; ✔ Got R6 2.5.1 (i386+x86_64-w64-mingw32) (84.99 kB)</span></span>
<span><span class="co">#&gt; ✔ Got magrittr 2.0.3 (x86_64-w64-mingw32) (229.48 kB)</span></span>
<span><span class="co">#&gt; ✔ Got posterior 1.5.0.9000 (i386+x86_64-w64-mingw32) (1.14 MB)</span></span>
<span><span class="co">#&gt; ✔ Got distributional 0.4.0 (i386+x86_64-w64-mingw32) (432.57 kB)</span></span>
<span><span class="co">#&gt; ✔ Got glue 1.7.0 (x86_64-w64-mingw32) (163.35 kB)</span></span>
<span><span class="co">#&gt; ✔ Got fansi 1.0.6 (x86_64-w64-mingw32) (323.11 kB)</span></span>
<span><span class="co">#&gt; ✔ Got generics 0.1.3 (i386+x86_64-w64-mingw32) (84.13 kB)</span></span>
<span><span class="co">#&gt; ✔ Got pkgconfig 2.0.3 (i386+x86_64-w64-mingw32) (22.82 kB)</span></span>
<span><span class="co">#&gt; ✔ Got cli 3.6.2 (x86_64-w64-mingw32) (1.36 MB)</span></span>
<span><span class="co">#&gt; ✔ Got data.table 1.15.4 (x86_64-w64-mingw32) (2.42 MB)</span></span>
<span><span class="co">#&gt; ✔ Got matrixStats 1.3.0 (x86_64-w64-mingw32) (551.79 kB)</span></span>
<span><span class="co">#&gt; ✔ Got withr 3.0.0 (i386+x86_64-w64-mingw32) (249.66 kB)</span></span>
<span><span class="co">#&gt; ✔ Got cmdstanr 0.8.1 (i386+x86_64-w64-mingw32) (1.57 MB)</span></span>
<span><span class="co">#&gt; ✔ Got utf8 1.2.4 (x86_64-w64-mingw32) (150.86 kB)</span></span>
<span><span class="co">#&gt; ✔ Got tibble 3.2.1 (x86_64-w64-mingw32) (695.34 kB)</span></span>
<span><span class="co">#&gt; ✔ Got lifecycle 1.0.4 (i386+x86_64-w64-mingw32) (140.92 kB)</span></span>
<span><span class="co">#&gt; ✔ Got processx 3.8.4 (x86_64-w64-mingw32) (688.52 kB)</span></span>
<span><span class="co">#&gt; ✔ Got jsonlite 1.8.8 (x86_64-w64-mingw32) (1.11 MB)</span></span>
<span><span class="co">#&gt; ✔ Got ps 1.7.6 (x86_64-w64-mingw32) (558.56 kB)</span></span>
<span><span class="co">#&gt; ✔ Got pillar 1.9.0 (i386+x86_64-w64-mingw32) (663.34 kB)</span></span>
<span><span class="co">#&gt; ✔ Got vctrs 0.6.5 (x86_64-w64-mingw32) (1.36 MB)</span></span>
<span><span class="co">#&gt; ✔ Installed cmdstanr 0.8.1  (2.5s)</span></span>
<span><span class="co">#&gt; ✔ Installed posterior 1.5.0.9000  (2.4s)</span></span>
<span><span class="co">#&gt; ✔ Installed R6 2.5.1  (2.6s)</span></span>
<span><span class="co">#&gt; ✔ Installed abind 1.4-5  (2.8s)</span></span>
<span><span class="co">#&gt; ✔ Installed backports 1.5.0  (2.9s)</span></span>
<span><span class="co">#&gt; ✔ Installed checkmate 2.3.1  (3.1s)</span></span>
<span><span class="co">#&gt; ✔ Installed distributional 0.4.0  (3.1s)</span></span>
<span><span class="co">#&gt; ✔ Installed fansi 1.0.6  (3.3s)</span></span>
<span><span class="co">#&gt; ✔ Installed generics 0.1.3  (3.4s)</span></span>
<span><span class="co">#&gt; ✔ Installed glue 1.7.0  (3.5s)</span></span>
<span><span class="co">#&gt; ✔ Installed numDeriv 2016.8-1.1  (3.3s)</span></span>
<span><span class="co">#&gt; ✔ Installed pkgconfig 2.0.3  (3.3s)</span></span>
<span><span class="co">#&gt; ✔ Installed processx 3.8.4  (3.4s)</span></span>
<span><span class="co">#&gt; ✔ Installed lifecycle 1.0.4  (4.1s)</span></span>
<span><span class="co">#&gt; ✔ Installed tensorA 0.36.2.1  (3.4s)</span></span>
<span><span class="co">#&gt; ✔ Installed ps 1.7.6  (3.8s)</span></span>
<span><span class="co">#&gt; ✔ Installed jsonlite 1.8.8  (4.7s)</span></span>
<span><span class="co">#&gt; ✔ Installed pillar 1.9.0  (4.5s)</span></span>
<span><span class="co">#&gt; ✔ Installed cli 3.6.2  (5.4s)</span></span>
<span><span class="co">#&gt; ✔ Installed utf8 1.2.4  (4.3s)</span></span>
<span><span class="co">#&gt; ✔ Installed magrittr 2.0.3  (5.3s)</span></span>
<span><span class="co">#&gt; ✔ Installed rlang 1.1.4  (4.8s)</span></span>
<span><span class="co">#&gt; ✔ Installed withr 3.0.0  (4.7s)</span></span>
<span><span class="co">#&gt; ✔ Installed tibble 3.2.1  (5.1s)</span></span>
<span><span class="co">#&gt; ✔ Installed vctrs 0.6.5  (5.2s)</span></span>
<span><span class="co">#&gt; ✔ Installed matrixStats 1.3.0  (6.4s)</span></span>
<span><span class="co">#&gt; ✔ Installed data.table 1.15.4  (7.2s)</span></span>
<span><span class="co">#&gt; ✔ Summary:   27 new  in 1m 48.2s</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Writing library description to 'hipercow/lib/windows/4.4.0/.conan/20240612125140'</span></span>
<span><span class="co">#&gt; Done!</span></span>
<span><span class="co">#&gt; ✔ Installation script finished successfully in 26.32 secs</span></span></code></pre></div>
<p>Now we can run our stan task (we need a decent timeout here as
compilation can be very slow):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">run_stan</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Submitted task '0f7dcc43b7ff14f57182bdf760add181' using 'dide-windows'</span></span>
<span><span class="fu"><a href="../reference/task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id</span>, timeout <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Here are the logs from the stan task, which has hopefully worked for
you, too.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_log.html">task_log_show</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── hipercow 1.0.12 running at 'V:/cluster/hipercow-vignette/hv-20240612-15d41827</span></span>
<span><span class="co">#&gt; ℹ library paths:</span></span>
<span><span class="co">#&gt; •</span></span>
<span><span class="co">#&gt; V:/cluster/hipercow-vignette/hv-20240612-15d41827525afc/hipercow/lib/windows/4.4.0</span></span>
<span><span class="co">#&gt; • I:/bootstrap/4.4.0</span></span>
<span><span class="co">#&gt; • C:/Program Files/R/R-4.4.0/library</span></span>
<span><span class="co">#&gt; ℹ id: 0f7dcc43b7ff14f57182bdf760add181</span></span>
<span><span class="co">#&gt; ℹ starting at: 2024-06-12 13:52:07.305275</span></span>
<span><span class="co">#&gt; ℹ Task type: expression</span></span>
<span><span class="co">#&gt;   • Expression: run_stan()</span></span>
<span><span class="co">#&gt;   • Locals: (none)</span></span>
<span><span class="co">#&gt;   • Environment: default</span></span>
<span><span class="co">#&gt;   • Environment variables: R_GC_MEM_GROW, CMDSTAN, and CMDSTANR_USE_RTOOLS</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────────── task logs ↓ ──</span></span>
<span><span class="co">#&gt; In file included from stan/lib/stan_math/stan/math/rev/fun.hpp:75,</span></span>
<span><span class="co">#&gt;                  from stan/lib/stan_math/stan/math/rev.hpp:12,</span></span>
<span><span class="co">#&gt;                  from stan/src/stan/model/log_prob_grad.hpp:4,</span></span>
<span><span class="co">#&gt;                  from src/cmdstan/command_helper.hpp:15,</span></span>
<span><span class="co">#&gt;                  from src/cmdstan/command.hpp:13,</span></span>
<span><span class="co">#&gt;                  from src/cmdstan/main.cpp:1:</span></span>
<span><span class="co">#&gt; stan/lib/stan_math/stan/math/rev/fun/generalized_inverse.hpp: In function 'auto stan::math::generalized_inverse(const VarMat&amp;)':</span></span>
<span><span class="co">#&gt; stan/lib/stan_math/stan/math/rev/fun/generalized_inverse.hpp:67: note: '-Wmisleading-indentation' is disabled from this point onwards, since column-tracking was disabled due to the size of the code/headers</span></span>
<span><span class="co">#&gt;    67 |   if (G.size() == 0)</span></span>
<span><span class="co">#&gt;       | </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; stan/lib/stan_math/stan/math/rev/fun/generalized_inverse.hpp:67: note: adding '-flarge-source-files' will allow for more column-tracking support, at the expense of compilation time and memory</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Running MCMC with 2 sequential chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 finished in 0.0 seconds.</span></span>
<span><span class="co">#&gt; Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 finished in 0.0 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Both chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 0.0 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 0.8 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────────── task logs ↑ ──</span></span>
<span><span class="co">#&gt; ✔ status: success</span></span>
<span><span class="co">#&gt; ℹ finishing at: 2024-06-12 13:52:07.305275 (elapsed: 4.633 mins)</span></span></code></pre></div>
<p>Note that drawing samples from this took very little time (look at
the last bit of stan output) compared with the total time taken for the
task (see the last line of <code>hipercow</code> output).</p>
<p>Once compilation of models succeeds, all that remains is the much
easier job of using your model to do amazing science.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Paul Liétar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
