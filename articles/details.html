<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Details • hipercow</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Details">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hipercow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/hipercow.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>General</h6></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Packages and provisioning</a></li>
    <li><a class="dropdown-item" href="../articles/parallel.html">Parallel Tasks</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
    <li><a class="dropdown-item" href="../articles/environments.html">Environments</a></li>
    <li><a class="dropdown-item" href="../articles/stan.html">Using stan</a></li>
    <li><a class="dropdown-item" href="../articles/INLA.html">Using INLA on Windows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clusters</h6></li>
    <li><a class="dropdown-item" href="../articles/dide-cluster.html">The DIDE Cluster</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/workers.html">Workers</a></li>
    <li><a class="dropdown-item" href="../articles/administration.html">Administration</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from didehpc</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/hipercow/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Details</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/hipercow/blob/main/vignettes/details.Rmd" class="external-link"><code>vignettes/details.Rmd</code></a></small>
      <div class="d-none name"><code>details.Rmd</code></div>
    </div>

    
    
<p>This vignette primarily exists so that we can point to it from other
bits of documentation, or requests for help, with details about doing
particular chores with <code>hipercow</code>.</p>
<div class="section level2">
<h2 id="options">Options<a class="anchor" aria-label="anchor" href="#options"></a>
</h2>
<p>There are a few influential options that control
<code>hipercow</code> behaviour, and you may want to set these if you
wish to depart from the defaults that we have set.</p>
<p>You can set an option within a session by using the
<code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> function, for example</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>hipercow.progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre>
<p>If you want a particular option to persist between sessions you
should edit your <code>.Rprofile</code> file, which is most easily done
by using <code>usethis::edit_r_profile()</code>.</p>
<div class="section level3">
<h3 id="influential-options">Influential options<a class="anchor" aria-label="anchor" href="#influential-options"></a>
</h3>
<div class="section level4">
<h4 id="hipercow-auto_install_missing_packages">
<code>hipercow.auto_install_missing_packages</code><a class="anchor" aria-label="anchor" href="#hipercow-auto_install_missing_packages"></a>
</h4>
<p>Logical, controlling if <code>hipercow</code> should install missing
packages as it needs them on your machine. The default is
<code>TRUE</code>, which will generally cause <code>hipercow.dide</code>
and <code>conan2</code> to be installed the first time you try and use
<code>hipercow</code>.</p>
</div>
<div class="section level4">
<h4 id="hipercow-progress">
<code>hipercow.progress</code><a class="anchor" aria-label="anchor" href="#hipercow-progress"></a>
</h4>
<p>Logical, controlling if we should display a progress bar in some
contexts (e.g., <code><a href="../reference/task_wait.html">task_wait()</a></code>). This affects the default
behaviour of any <code>hipercow</code> function accepting a
<code>progress</code> argument, with this option becoming the default
value in the absence of an explicit argument. That is, you can always
disable individual progress bars but this option lets you disable them
by default. The default value of this option is <code>TRUE</code> (i.e.,
display progress bars by default).</p>
</div>
<div class="section level4">
<h4 id="hipercow-timeout">
<code>hipercow.timeout</code><a class="anchor" aria-label="anchor" href="#hipercow-timeout"></a>
</h4>
<p>Numeric, controlling the default timeout for
<code><a href="../reference/task_wait.html">task_wait()</a></code>, <code><a href="../reference/task_log.html">task_log_watch()</a></code> ,
<code><a href="../reference/hipercow_bundle_wait.html">hipercow_bundle_wait()</a></code> and <code><a href="../reference/hipercow_hello.html">hipercow_hello()</a></code>.
If not set, the default is <code>Inf</code> (i.e., wait forever).</p>
</div>
<div class="section level4">
<h4 id="hipercow-validate_globals">
<code>hipercow.validate_globals</code><a class="anchor" aria-label="anchor" href="#hipercow-validate_globals"></a>
</h4>
<p>Logical, controlling if we validate the value of “global” variables
when a task starts. If <code>TRUE</code>, then when we save a task
(e.g., with <code><a href="../reference/task_create_expr.html">task_create_expr()</a></code>) <em>and</em> where you have
created an environment with <code><a href="../reference/hipercow_environment.html">hipercow_environment_create()</a></code>
<em>and</em> specified values for the <code>globals</code> argument,
then we hash the values that we find in your current session and when
the task starts on the cluster we validate that the values that we find
are the same as in your local session. The default is <code>FALSE</code>
(i.e., this validation is not done).</p>
</div>
<div class="section level4">
<h4 id="hipercow-max_size_local">
<code>hipercow.max_size_local</code><a class="anchor" aria-label="anchor" href="#hipercow-max_size_local"></a>
</h4>
<p>A number, being the maximum size object (in bytes) that we will save
when creating a task (e.g., with <code><a href="../reference/task_create_expr.html">task_create_expr()</a></code>). When
we save a task we need to save all local variables that you reference in
the call; often these are small and it’s no problem. However, if you
pass in a 5GB shapefile then you will end up filling up the disk with
copies of this file, and your task will spend a lot of time reading and
writing them. It’s usually better to arrange for large objects to be
found from your scripts via your environment. The default value is
<code>1e6</code> (1,000,000 bytes, or 1 MB). Set to <code>Inf</code> to
disable this check.</p>
</div>
<div class="section level4">
<h4 id="hipercow-default_envvars">
<code>hipercow.default_envvars</code><a class="anchor" aria-label="anchor" href="#hipercow-default_envvars"></a>
</h4>
<p>A <code>hipercow_envvars</code> object, with environment variables
that will be added to every task created. Hipercow sets a few
environment variables by default to improve the user experience. These
variables can be overridden per-task by passing a <code>envvars</code>
parameter when creating tasks, or globally by defining this option.</p>
<p>Environment variables for a task are computed by collecting (in
increasing order of preference):</p>
<ul>
<li>
<code>hipercow</code> default environment variables (defined in
<code>hipercow:::DEFAULT_ENVVARS</code>); currently
<code>R_GC_MEM_GROW=3</code>
</li>
<li>driver-specific variables (defined by the
<code>default_envvars</code> argument to <code>hipercow_driver</code>);
see <code><a href="../articles/dide-cluster.html">vignette("dide-cluster")</a></code> for defaults specific to our
DIDE cluster</li>
<li>the user-set option <code>hipercow.default_envvars</code>
</li>
<li>the argument <code>envvars</code> to a task creation function</li>
</ul>
<p>Environment variables set later override those earlier.</p>
</div>
<div class="section level4">
<h4 id="hipercow-development">
<code>hipercow.development</code><a class="anchor" aria-label="anchor" href="#hipercow-development"></a>
</h4>
<p>Use the development library (if it exists) for bootstrapping. We may
ask you to set this temporarily if we are diagnosing a bug with you.
Don’t set this yourself generally as the library will often not exist,
or be out of date!</p>
</div>
</div>
<div class="section level3">
<h3 id="dide-options">DIDE options<a class="anchor" aria-label="anchor" href="#dide-options"></a>
</h3>
<div class="section level4">
<h4 id="hipercow-timeout-1">
<code>hipercow.timeout</code><a class="anchor" aria-label="anchor" href="#hipercow-timeout-1"></a>
</h4>
<p>A number, representing seconds, for timing out when performing web
requests. The default is 10s but if we have chosen this poorly you may
need to increase or decrease it.</p>
</div>
</div>
<div class="section level3">
<h3 id="rrq-options">rrq options<a class="anchor" aria-label="anchor" href="#rrq-options"></a>
</h3>
<p>These options are only relevant when using <code>hipercow</code> rrq
integration.</p>
<div class="section level4">
<h4 id="hipercow-rrq_offload_threshold_size">
<code>hipercow.rrq_offload_threshold_size</code><a class="anchor" aria-label="anchor" href="#hipercow-rrq_offload_threshold_size"></a>
</h4>
<p>Objects passed to and from rrq tasks are usually stored in Redis.
However since these are all stored in memory, larger objects are
offloaded to the disk instead. This option controls the threshold used
to decide whether or not to offload objects. Objects larger than the
configured value (in bytes) are offloaded to disk.</p>
<p>The default value is 100000, i.e., 100kB.</p>
<p>This option is used when the queue is first created. Changing it
afterwards will have no effect.</p>
</div>
</div>
<div class="section level3">
<h3 id="options-from-other-packages">Options from other packages<a class="anchor" aria-label="anchor" href="#options-from-other-packages"></a>
</h3>
<p>We make heavy use of the <a href="https://cli.r-lib.org/" class="external-link"><code>cli</code></a> package, see its <a href="https://cli.r-lib.org/reference/cli-config.html" class="external-link">documentation on
options</a>. Particular options that you might care about:</p>
<ul>
<li><p><strong><code>cli.progress_show_after</code></strong>: Delay in
seconds before showing the progress bar; you might reduce this to make
bars appear more quickly.</p></li>
<li><p><strong><code>cli.progress_clear</code></strong>: Retain the
progress bar on screen after completion.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="setting-options">Setting options<a class="anchor" aria-label="anchor" href="#setting-options"></a>
</h3>
<p>You can set options either within a session by using the
<code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> function or for all future sessions by editing
your <code>.Rprofile</code>.</p>
<p>Changing an option with <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> looks like:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>hipercow.max_size_local <span class="op">=</span> <span class="fl">1e7</span><span class="op">)</span></span></code></pre></div>
<p>You might put this at the top of your cluster script and it will
affect any future tasks that you submit within that session after you
run it. You’ll probably run this line next time, so it would have an
effect there too. It won’t affect any other project.</p>
<p>If you always want that value, you can add it to your
<code>.Rprofile</code>. The easiest way of doing this is by using the
<code>usethis</code> package and running:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">edit_r_profile</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>and then adding a call to <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> anywhere in that
file. If you are comfortable with using (and exiting) <code>vi</code> on
the command line you may prefer using <code>vi ~/.Rprofile</code>.</p>
<p>After changing your <code>.Rprofile</code> you will need to restart R
for the changes to take effect.</p>
<p>You can set multiple options at once if you want by running (for
example):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  hipercow.progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  hipercow.max_size_local <span class="op">=</span> <span class="fl">1e-7</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="r-versions">R versions<a class="anchor" aria-label="anchor" href="#r-versions"></a>
</h2>
<p>By default, we try and track a “suitable” copy of R based on your
current version. We will try and use exactly the same version if
available, otherwise the oldest cluster version that is newer than
yours, or failing that the most recent cluster version.</p>
<p>You can control the R version used when configuring; for example to
use <code>4.3.0</code> exactly you can use:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_configure.html">hipercow_configure</a></span><span class="op">(</span><span class="st">"dide-windows"</span>, r_version <span class="op">=</span> <span class="st">"4.3.0"</span><span class="op">)</span></span></code></pre></div>
<p>Not every minor version is installed, and available versions may
differ between <code>dide-windows</code> and <code>dide-linux</code>.
But we should have a version close enough to what you need.</p>
<p>Try not to use versions that are more than one “minor” version old
(the middle version number). You can see the current version on <a href="https://cran.r-project.org/" class="external-link">CRAN’s landing page</a>. If it is
<code>4.3.x</code> then versions in the <code>4.2.x</code> and
<code>4.3.x</code> series will likely work well for you, but
<code>4.1.x</code> and earlier will not work well because binary
versions of packages are no longer available and because some packages
will start depending on features present in newer versions, so may not
be available.</p>
</div>
<div class="section level2">
<h2 id="workflow-considerations">Workflow considerations<a class="anchor" aria-label="anchor" href="#workflow-considerations"></a>
</h2>
<div class="section level3">
<h3 id="long-running-tasks">Long running tasks<a class="anchor" aria-label="anchor" href="#long-running-tasks"></a>
</h3>
<p>The R session that you use to send tasks to the cluster is not
important; only the directory from which you send the tasks. So you can
stop the R session, reboot your computer or shut down your laptop and
your tasks will keep running (or keep waiting for the cluster to pick
them up). If you come back to the same working directory later you can
ask about a task’s status, fetch its results etc easily.</p>
</div>
<div class="section level3">
<h3 id="disk-space">Disk space<a class="anchor" aria-label="anchor" href="#disk-space"></a>
</h3>
<p>If you run out of disk space, terrible things will happen, and the
error messages that you get may be misleading. Worse, you may run out of
space, then have some space gets freed up so that it’s not obvious what
the original problem was.</p>
<p>The underlying reason for this is that we store information about the
state of tasks on your network share; if you run out of space while
writing the final result of a task, then that task will remain as
<code>running</code> indefinitely because we fail to write out that it
succeeded.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Paul Liétar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
