<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>hipercow • hipercow</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="hipercow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hipercow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/hipercow.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>General</h6></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Packages and provisioning</a></li>
    <li><a class="dropdown-item" href="../articles/parallel.html">Parallel Tasks</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
    <li><a class="dropdown-item" href="../articles/environments.html">Environments</a></li>
    <li><a class="dropdown-item" href="../articles/stan.html">Using stan</a></li>
    <li><a class="dropdown-item" href="../articles/INLA.html">Using INLA on Windows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clusters</h6></li>
    <li><a class="dropdown-item" href="../articles/dide-cluster.html">The DIDE Cluster</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/workers.html">Workers</a></li>
    <li><a class="dropdown-item" href="../articles/administration.html">Administration</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from didehpc</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/hipercow/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>hipercow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/hipercow/blob/main/vignettes/hipercow.Rmd" class="external-link"><code>vignettes/hipercow.Rmd</code></a></small>
      <div class="d-none name"><code>hipercow.Rmd</code></div>
    </div>

    
    
<p>Parallel computing on a cluster can be more challenging than running
things locally because it’s often the first time that you need to
package up code to run elsewhere, and when things go wrong it’s more
difficult to get information on why things failed.</p>
<p>Much of the difficulty of getting things running involves working out
what your code depends on, and getting that installed in the right place
on a computer that you can’t physically poke at. The next set of
problems is dealing with the ballooning set of files that end up being
created - templates, scripts, output files, etc.</p>
<p>The <code>hipercow</code> package aims to remove some of this pain,
with the aim that running a task on the cluster should be (almost) as
straightforward as running things locally, at least once some basic
setup is done.</p>
<p>This manual is structured in escalating complexity, following the
chain of things that a hypothetical user might encounter as they move
from their first steps on the cluster through to running enormous
batches of tasks.</p>
<div class="section level2">
<h2 id="clusters-and-platforms">Clusters and Platforms<a class="anchor" aria-label="anchor" href="#clusters-and-platforms"></a>
</h2>
<p>In this documentation, by <em>cluster</em>, we mean really a
head-node. We support one of these at the moment: the DIDE cluster. In
the future, we might also support the PBS cluster that ICT run, or we
might create a pure Linux cluster with a SLURM headnode for instance.
But not yet.</p>
<p>By <em>platform</em>, we mean operating system. You can use
<code>hipercow</code> on your own computer, whether it runs Windows,
Linux or MacOS. There are differences between these operating systems,
mostly about how to refer to your DIDE network paths as they appear on
your computer (ie, drive letters or mountpoints), and
<code>hipercow</code> tries to handle those for you without any
fuss.</p>
<p>Until recently, your jobs would then be run on Windows cluster nodes.
However, unusually (and perhaps interestingly), our DIDE cluster runs
Microsoft HPC, which can have both Linux-based and Windows-based nodes
attached to it, using the same basic launch tools for either. This is
interesting, since it can allow Linux jobs to be run, but with a launch
mechanism extremely similar to what you might already be familiar with
from <code>hipercow</code>.</p>
<p>So throughout this documentation, we will refer to one
<em>cluster</em>, (the DIDE cluster), supporting two <em>target
platforms</em> - compute nodes running Windows or Linux. Please do
feedback your experiences especially on the Linux nodes, as this is new
and we’d like to know what workflows work well for you.</p>
</div>
<div class="section level2">
<h2 id="installing-prerequisites">Installing prerequisites<a class="anchor" aria-label="anchor" href="#installing-prerequisites"></a>
</h2>
<p>Install the required packages from our “r-universe”. Be sure to run
this in a fresh session.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span></span>
<span>  <span class="st">"hipercow"</span>,</span>
<span>  repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://mrc-ide.r-universe.dev"</span>, <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Once installed you can load the package with</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrc-ide/hipercow" class="external-link">hipercow</a></span><span class="op">)</span></span></code></pre></div>
<p>or use the package by prefixing the calls below with
<code>hipercow::</code>, as you prefer.</p>
<p>Follow any cluster-specific instructions in
<code>vignettes("&lt;cluster&gt;")</code>; this will depend on the
cluster you intend to use - at present just our DIDE cluster.</p>
<ul>
<li>The DIDE Cluster: <code><a href="../articles/dide-cluster.html">vignette("dide-cluster")</a></code>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="filesystems-and-paths">Filesystems and paths<a class="anchor" aria-label="anchor" href="#filesystems-and-paths"></a>
</h2>
<p>We need a concept of a “root”; the point in the filesystem we can
think of everything relative to. This will feel familiar to you if you
have used git or orderly, as these all have a root (and this root will
be a fine place to put your cluster work). Typically all paths will be
<em>within</em> this root directory, and paths above it, or absolute
paths in general, effectively cease to exist. If your project works this
way then it’s easy to move around, which is exactly what we need to do
in order to run it on the cluster.</p>
<p>If you are using RStudio, then we strongly recommend using an <a href="https://support.posit.co/hc/en-us/articles/200526207-Using-RStudio-Projects" class="external-link">RStudio
project</a>.</p>
</div>
<div class="section level2">
<h2 id="initialising">Initialising<a class="anchor" aria-label="anchor" href="#initialising"></a>
</h2>
<p>Run</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_init.html">hipercow_init</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Initialised hipercow at '.' (/home/runner/work/_temp/hv-20250513-305179608ad8)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Next, call 'hipercow_configure()'</span></span></code></pre></div>
<p>which will write things to a new path <code>hipercow/</code> within
your working directory.</p>
<p>After initialisation you will typically want to configure a “driver”,
which controls how tasks are sent to clusters. There are two options for
this: <code>dide-windows</code> and <code>dide-linux</code> which will
target nodes running either operating system on our DIDE cluster. For
example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_configure.html">hipercow_configure</a></span><span class="op">(</span>driver <span class="op">=</span> <span class="st">"dide-windows"</span><span class="op">)</span></span></code></pre></div>
<p>however, for this vignette we will use a special “example” driver
which simulates what the cluster will do (don’t use this for anything
yourself, it really won’t help):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_configure.html">hipercow_configure</a></span><span class="op">(</span>driver <span class="op">=</span> <span class="st">"example"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Configured hipercow to use 'example'</span></span></code></pre></div>
<p>You can run initialisation and configuration in one step by running,
for example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_init.html">hipercow_init</a></span><span class="op">(</span>driver <span class="op">=</span> <span class="st">"dide-linux"</span><span class="op">)</span></span></code></pre></div>
<p>Whether you want to target Windows or Linux, by setting the driver to
<code>dide-windows</code> or <code>dide-linux</code> respectively, all
the <code>hipercow</code> commands that follow will be the same.</p>
<p>After initialisation and configuration you can see the computed
configuration by running <code><a href="../reference/hipercow_configuration.html">hipercow_configuration()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_configuration.html">hipercow_configuration</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">hipercow root at /home/runner/work/_temp/hv-20250513-305179608ad8</span> <span style="color: #00BBBB;">───────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Working directory '.' within root</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> R version 4.5.0 on Linux (runner@fv-az1112-967)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Packages</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> This is hipercow 1.1.5</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Installed: conan2 (1.9.102), logwatch (0.1.1), rrq (0.7.23)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> hipercow.dide is not installed</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Environments</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── default</span></span>
<span><span class="co">#&gt; • packages: <span style="font-style: italic;">(none)</span></span></span>
<span><span class="co">#&gt; • sources: <span style="font-style: italic;">(none)</span></span></span>
<span><span class="co">#&gt; • globals: <span style="font-style: italic;">(none)</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── empty</span></span>
<span><span class="co">#&gt; • packages: <span style="font-style: italic;">(none)</span></span></span>
<span><span class="co">#&gt; • sources: <span style="font-style: italic;">(none)</span></span></span>
<span><span class="co">#&gt; • globals: <span style="font-style: italic;">(none)</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Drivers</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 1 driver configured ('example')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── example</span></span>
<span><span class="co">#&gt; (unconfigurable)</span></span></code></pre></div>
<p>Here, you can see versions of important packages, information about
where you are working, and information about how you intend to interact
with the cluster. See <code><a href="../articles/dide-cluster.html">vignette("dide-cluster")</a></code> for example
output you might expect to see, which includes information about mapping
of your paths onto those of the cluster, the version of R you will use,
and other information.</p>
<p>If you have issues with <code>hipercow</code> we will always want to
see the output of <code><a href="../reference/hipercow_configuration.html">hipercow_configuration()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="running-your-first-task">Running your first task<a class="anchor" aria-label="anchor" href="#running-your-first-task"></a>
</h2>
<p>The first time you use the tools (ever, in a while, or on a new
machine) we recommend sending off a tiny task to make sure that
everything is working as expected:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted task '6cab25285f8adcc8783ed74db73349ce' using 'example'</span></span></code></pre></div>
<p>This creates a new task that will run the expression
<code><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo()</a></code> on the cluster. The
<code><a href="../reference/task_create_expr.html">task_create_expr()</a></code> function works by so-called <a href="https://adv-r.hadley.nz/metaprogramming.html" class="external-link">“non standard
evaluation”</a> and the expression is not evaluated from your R session,
but sent to run on another machine.</p>
<p>The <code>id</code> returned is just an ugly hex string:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span></span>
<span><span class="co">#&gt; [1] "6cab25285f8adcc8783ed74db73349ce"</span></span></code></pre></div>
<p>Many other functions accept this <code>id</code> as an argument. You
can get the status of the task, which will have finished now because it
really does not take very long:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_status.html">task_status</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "success"</span></span></code></pre></div>
<p>Once the task has completed you can inspect the result:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_result.html">task_result</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.0 (2025-04-11)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.2 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt; [1] compiler_4.5.0 cli_3.6.5      withr_3.0.2    hipercow_1.1.5 rlang_1.1.6</span></span></code></pre></div>
<p>Because we are using the “example” driver here, this is the same as
the result that you’d get running <code><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo()</a></code> directly,
just with more steps. See <code><a href="../articles/dide-cluster.html">vignette("dide-cluster")</a></code> for
examples running on the DIDE cluster.</p>
</div>
<div class="section level2">
<h2 id="using-functions-you-have-written">Using functions you have written<a class="anchor" aria-label="anchor" href="#using-functions-you-have-written"></a>
</h2>
<p>It’s unlikely that the code you want to run on the cluster is one of
the functions built into R itself; more likely you have written a
simulation or similar and you want to run <em>that</em> instead. In
order to do this, we need to tell the cluster where to find your code.
There are two broad places where code that you want to run is likely to
be found <strong>script files</strong> and <strong>packages</strong>; we
start with the former here, and deal with packages in much more detail
in <code><a href="../articles/packages.html">vignette("packages")</a></code>.</p>
<p>Suppose you have a file <code>simulation.R</code> containing some
simulation:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_walk</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n_steps</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">n_steps</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_steps</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">ret</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">ret</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can’t run this on the cluster immediately, because the cluster
does not know about the new function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">random_walk</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted task 'e3c549aa662076f138d997b349141983' using 'example'</span></span>
<span><span class="fu"><a href="../reference/task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="../reference/task_status.html">task_status</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "failure"</span></span>
<span><span class="fu"><a href="../reference/task_result.html">task_result</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;simpleError in random_walk(0, 10): could not find function "random_walk"&gt;</span></span></code></pre></div>
<p>(See <code><a href="../articles/troubleshooting.html">vignette("troubleshooting")</a></code> for more on
failures.)</p>
<p>We need to tell <code>hipercow</code> to <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> the
file <code>simulation.R</code> before running the task. To do this we
use <code><a href="../reference/hipercow_environment.html">hipercow_environment_create()</a></code> to create an
“environment” (not to be confused with R’s environments) in which to run
things:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_environment.html">hipercow_environment_create</a></span><span class="op">(</span>sources <span class="op">=</span> <span class="st">"simulation.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created environment 'default'</span></span></code></pre></div>
<p>Now we can run our simulation:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">random_walk</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted task '09213fb7bd59b73b4f59eb6dde4dfb9b' using 'example'</span></span>
<span><span class="fu"><a href="../reference/task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/task_result.html">task_result</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  0.1255874 -0.6147476 -0.8554281 -1.1544391 -0.1096971  1.4239720</span></span>
<span><span class="co">#&gt;  [7]  1.9851303  0.5507115  1.2954113  0.7485067</span></span></code></pre></div>
<ul>
<li>You can have multiple environments and each task can be set to run
in a different environment</li>
<li>Each environment can source any number of source files, and load any
number of packages</li>
<li>This will become the mechanism by which environments on parallel
workers (via <code>parallel</code>, <code>future</code> or
<code>rrq</code>) will set up their environments</li>
</ul>
<p>Read more about environments in
<code><a href="../articles/environments.html">vignette("environments")</a></code></p>
</div>
<div class="section level2">
<h2 id="getting-information-about-tasks">Getting information about tasks<a class="anchor" aria-label="anchor" href="#getting-information-about-tasks"></a>
</h2>
<p>Once you have created (and submitted) tasks, they will be queued by
the cluster and eventually run. The hope is that we surface enough
information to make it easy for you to see how things are going and what
has gone wrong.</p>
<div class="section level3">
<h3 id="fetching-information-with-task_info">Fetching information with <code>task_info()</code><a class="anchor" aria-label="anchor" href="#fetching-information-with-task_info"></a>
</h3>
<p>The primary function for fetching information about a task is
<code><a href="../reference/task_info.html">task_info()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_info.html">task_info</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">task 09213fb7bd59b73b4f59eb6dde4dfb9b (success)</span> <span style="color: #00BBBB;">─────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Submitted with 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Task type: expression</span></span>
<span><span class="co">#&gt;   • Expression: random_walk(0, 10)</span></span>
<span><span class="co">#&gt;   • Locals: (none)</span></span>
<span><span class="co">#&gt;   • Environment: default</span></span>
<span><span class="co">#&gt;     R_GC_MEM_GROW: 3</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Created at 2025-05-13 06:44:39.467212 (moments ago)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Started at 2025-05-13 06:44:39.510449 (moments ago; waited 44ms)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Finished at 2025-05-13 06:44:39.511523 (moments ago; ran for 2ms)</span></span></code></pre></div>
<p>This prints out core information about the task; its identifier
(<code>09213fb7bd59b73b4f59eb6dde4dfb9b</code>) and status
(<code>success</code>), along with information about what sort of task
it was, what expression it had, variables it used, the environment it
executed in and the time that key events happened for the task (when it
was created, started and finished).</p>
<p>This display is meant to be friendly; if you need to compute on this
information, you can access the times by reading the <code>$times</code>
element of the <code><a href="../reference/task_info.html">task_info()</a></code> return value:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_info.html">task_info</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">$</span><span class="va">times</span></span>
<span><span class="co">#&gt;                   created                   started                  finished </span></span>
<span><span class="co">#&gt; "2025-05-13 06:44:39 UTC" "2025-05-13 06:44:39 UTC" "2025-05-13 06:44:39 UTC"</span></span></code></pre></div>
<p>Likewise, the information about the task itself is within
<code>$data</code>. To work with the underling data you might just
unclass the object to see the structure:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="fu"><a href="../reference/task_info.html">task_info</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $id</span></span>
<span><span class="co">#&gt; [1] "09213fb7bd59b73b4f59eb6dde4dfb9b"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] "success"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt; $data$type</span></span>
<span><span class="co">#&gt; [1] "expression"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data$id</span></span>
<span><span class="co">#&gt; [1] "09213fb7bd59b73b4f59eb6dde4dfb9b"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data$time</span></span>
<span><span class="co">#&gt; [1] "2025-05-13 06:44:39 UTC"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data$path</span></span>
<span><span class="co">#&gt; [1] "."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data$environment</span></span>
<span><span class="co">#&gt; [1] "default"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data$envvars</span></span>
<span><span class="co">#&gt;            name value secret</span></span>
<span><span class="co">#&gt; 1 R_GC_MEM_GROW     3  FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data$parallel</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data$expr</span></span>
<span><span class="co">#&gt; random_walk(0, 10)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $data$variables</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $driver</span></span>
<span><span class="co">#&gt; [1] "example"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $times</span></span>
<span><span class="co">#&gt;                   created                   started                  finished </span></span>
<span><span class="co">#&gt; "2025-05-13 06:44:39 UTC" "2025-05-13 06:44:39 UTC" "2025-05-13 06:44:39 UTC" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $retry_chain</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>but note that the exact structure is subject to (infrequent)
change.</p>
</div>
<div class="section level3">
<h3 id="fetching-logs-with-task_log_show">Fetching logs with <code>task_log_show</code><a class="anchor" aria-label="anchor" href="#fetching-logs-with-task_log_show"></a>
</h3>
<p>Every task will produce some logs, and these can be an important part
of understanding what they did and why they went wrong.</p>
<p>You can view the log with <code><a href="../reference/task_log.html">task_log_show()</a></code></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_log.html">task_log_show</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No logs for task '09213fb7bd59b73b4f59eb6dde4dfb9b' (yet?)</span></span></code></pre></div>
<p>This prints the contents of the logs to the screen; you can access
the values directly with <code>task_log_value(id)</code>. The format of
the logs will be generally the same for all tasks; after the header
saying where we are running, some information about the task will be
printed (its identifier, the time, details about the task itself), then
any logs that come from calls to <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code> and
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> within the queued function (within the “task logs”
section; here that is empty because our task prints nothing). Finally, a
summary will be printed with the final status, final time (and elapsed
time), then any warnings that were produced will be flushed (see
<code><a href="../articles/troubleshooting.html">vignette("troubleshooting")</a></code> for more on warnings).</p>
<p>There is a second log too, the “outer” log, which is generally less
interesting so it is not the default. These logs come from the cluster
scheduler itself and show the startup process that leads up to (and
after) the code that <code>hipercow</code> itself runs. It will differ
from driver to driver. In addition, this log may not be available
forever; the DIDE cluster retains it only for a couple of weeks:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_log.html">task_log_show</a></span><span class="op">(</span><span class="va">id</span>, outer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No logs for task '09213fb7bd59b73b4f59eb6dde4dfb9b' (yet?)</span></span></code></pre></div>
<p>The logs returned by <code>task_log_show(id, outer = FALSE)</code>
are the logs generated by the statement containing
<code>Rscript -e</code>.</p>
</div>
<div class="section level3">
<h3 id="watching-logs-with-task_log_watch">Watching logs with <code>task_log_watch</code><a class="anchor" aria-label="anchor" href="#watching-logs-with-task_log_watch"></a>
</h3>
<p>If your task is still running, you can stream logs to your computer
using <code><a href="../reference/task_log.html">task_log_watch()</a></code>; this will print new logs
line-by-line as they arrive (with a delay of up to 1s by default). This
can be useful while debugging something to give the illusion that you’re
running it locally.</p>
<p>Using <code>Ctrl-C</code> (or <code>ESC</code> in RStudio) to escape
will only stop log streaming and not the underlying task.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-many-tasks-at-once">Running many tasks at once<a class="anchor" aria-label="anchor" href="#running-many-tasks-at-once"></a>
</h2>
<p>Running one task on the cluster is nice, because it takes the load
off your laptop, but it’s generally not why you’re going through this
process. More likely, you have <strong>many, similar, tasks</strong>
that you want to set running at once. You might be:</p>
<ul>
<li>Fitting a model to a series of countries</li>
<li>Exploring uncertainty in a parameter</li>
<li>Running a series of stochastic processes</li>
</ul>
<p>In all these cases, you would want to submit a group of
<strong>related</strong> tasks, sharing a common function, but differing
in the data passed into that function. We call this the “bulk
interface”, and it is the simplest and usually most effective way of
getting started with parallel computing.</p>
<p>This sort of problem is referred to as <a href="https://en.wikipedia.org/wiki/Embarrassingly_parallel" class="external-link">“embarrassingly
parallel”</a>; this is not a pejorative, it just means that your work
decomposes into a bunch of independent chunks and all we have to do is
start them. You are already familiar with things that can be run this
way: anything that can be run with R’s <code>lapply</code> could be
parallelised.</p>
<p>There are two similar bulk creation functions, which differ based on
the way the data you have are structured:</p>
<ul>
<li>
<code>task_create_bulk_call</code> is used where you have a
<code>list</code>, where each element represents the key input to some
computation (this is similar to <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>)</li>
<li>
<code>task_create_bulk_expr</code> is used where you have a
<code>data.frame</code>, where each <strong>row</strong> represents the
inputs to some computation (this is a little similar to
<code>dplyr</code>’s <a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link"><code>rowwise</code></a>
support)</li>
</ul>
<div class="section level3">
<h3 id="bulk-call-or-parallel-map">Bulk call, or “parallel map”<a class="anchor" aria-label="anchor" href="#bulk-call-or-parallel-map"></a>
</h3>
<p>The bulk call interface is the one that might feel most familiar to
you; it is modelled on ideas from functions like <code>lapply</code>
(or, if you use <code>purrr</code>, its <code>map()</code> function).
The idea is simple, we have a list of data and we apply some function to
each element within it.</p>
<p>We’ll start with a reminder of how <code>lapply</code> works, then
adapt this to run in parallel on a cluster. Imagine that we want to run
some simple simulation with a different parameter. In this example we
simulate <code>n</code> samples from a normal distribution and compute
the observed mean and variance:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mysim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span>, <span class="va">sd</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">mu</span>, <span class="va">sd</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can run locally it like this:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"simulation-bulk.R"</span><span class="op">)</span></span>
<span><span class="fu">mysim</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.004339615 1.000001295</span></span></code></pre></div>
<p>Suppose that we have a vector of means to run this with:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>We can apply <code>mysim</code> to each of the elements of
<code>mu</code> by writing:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">mysim</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] -0.01626336  0.93585134</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 1.0384556 0.9996111</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 1.9584970 0.9689123</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 3.057711 1.006066</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 4.0052268 0.9658853</span></span></code></pre></div>
<p>Of note here:</p>
<ul>
<li>Only the <code>mu</code> argument was iterated over</li>
<li>We provided a <code>sd</code> argument that was passed through to
every call to <code>mysim</code>
</li>
<li>We get back a list in return, the same length as <code>mu</code>,
with each element the result of applying <code>mysim</code> to that
element.</li>
</ul>
<p>Nothing in the above said anything about the <em>order</em> in which
these calculations were carried out; one might assume that we applied
<code>myfun</code> to the first element of <code>mu</code> at once, then
the second, but that is just conjecture. This last point seems a bit
silly, but is a useful condition to think about when considering what
can be parallelised; if you can run a “loop” backwards and get the same
answer (ignoring things like the specific draws from random number
generating functions) then your problem is well suited to being
parallelised.</p>
<p>Our function <code>mysim</code> is in a file called
<code>simulation-bulk.R</code>, which we’ll add to our environment so
that it’s available on the cluster (alongside <code>random_walk</code>
from above):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_environment.html">hipercow_environment_create</a></span><span class="op">(</span>sources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simulation.R"</span>, <span class="st">"simulation-bulk.R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Updated environment 'default'</span></span></code></pre></div>
<p>We can then submit tasks to the cluster using
<code>task_create_bulk_call</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bundle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_bulk_call.html">task_create_bulk_call</a></span><span class="op">(</span><span class="va">mysim</span>, <span class="va">mu</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted 5 tasks using 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created bundle 'rearmost_chrysalis' with 5 tasks</span></span>
<span><span class="va">bundle</span></span>
<span><span class="co">#&gt; → &lt;hipercow_bundle 'rearmost_chrysalis' with 5 tasks&gt;</span></span></code></pre></div>
<p>This creates a <strong>task bundle</strong> which groups together
related tasks. There is a whole set of functions for working with
bundles that behave similarly to the task query functions. So where
<code><a href="../reference/task_status.html">task_status()</a></code> retrieves the status for a single task, we
can get the status for a bundle by running</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_bundle_status.html">hipercow_bundle_status</a></span><span class="op">(</span><span class="va">bundle</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "success" "success" "success" "success" "success"</span></span></code></pre></div>
<p>which returns a vector over all tasks included in the bundle. You can
also “reduce” this status to the “worst” status over all tasks:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_bundle_status.html">hipercow_bundle_status</a></span><span class="op">(</span><span class="va">bundle</span>, reduce <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "success"</span></span></code></pre></div>
<p>Similarly, you can wait for a whole bundle to complete</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_bundle_wait.html">hipercow_bundle_wait</a></span><span class="op">(</span><span class="va">bundle</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>And then get the results as a list</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_bundle_result.html">hipercow_bundle_result</a></span><span class="op">(</span><span class="va">bundle</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] -0.02248414  0.97774126</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 1.033726 1.064940</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 1.970805 1.000775</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 3.002703 1.013349</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 3.997295 0.989268</span></span></code></pre></div>
<p>This flow (<code>create</code>, <code>wait</code>,
<code>result</code>) is equivalent to <code>lapply</code> and produces
data of the same shape in return, but the tasks will be carried out in
parallel! Each task is submitted to the cluster and picked up by the
first available node. You might submit 100 tasks and if the cluster is
quiet, a few seconds later all of them will be running at the same
time.</p>
<p>We might want to vary <em>both</em> <code>mu</code> and
<code>sd</code>, in which case it might be convenient to keep track of
our inputs in a <code>data.frame</code>:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">mu</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mu</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can use <code>task_create_bundle_call</code> with this, too:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_bulk_call.html">task_create_bulk_call</a></span><span class="op">(</span><span class="va">mysim</span>, <span class="va">pars</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted 5 tasks using 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created bundle 'carneous_hoki' with 5 tasks</span></span>
<span><span class="fu"><a href="../reference/hipercow_bundle_wait.html">hipercow_bundle_wait</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/hipercow_bundle_result.html">hipercow_bundle_result</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] -0.03819042  1.02408766</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 1.008840 2.101506</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 2.069847 3.023502</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 2.923402 3.845022</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 3.864101 4.942739</span></span></code></pre></div>
<p>This iterates over the data in a <strong>row-wise</strong> way. Note
that this is very different to <code>lapply</code> which would iterate
over <strong>columns</strong> (in practice we find that this is almost
never what people want). The names of the columns must match the names
of your function arguments and all columns must be used.</p>
<p>We could have passed additional arguments here too, for example
changing <code>n</code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_bulk_call.html">task_create_bulk_call</a></span><span class="op">(</span><span class="va">mysim</span>, <span class="va">pars</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted 5 tasks using 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created bundle 'albinic_bird' with 5 tasks</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bulk-expression">Bulk expression<a class="anchor" aria-label="anchor" href="#bulk-expression"></a>
</h3>
<p>We also support a bulk expression interface, which can be clearer
than the above.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_bulk_expr.html">task_create_bulk_expr</a></span><span class="op">(</span><span class="fu">mysim</span><span class="op">(</span><span class="va">mu</span>, <span class="va">sd</span>, n <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>, <span class="va">pars</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted 5 tasks using 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created bundle 'trainsick_husky' with 5 tasks</span></span></code></pre></div>
<p>This would again work row-wise over <code>pars</code> but evaluate
the expression in the first argument with the data found in the
<code>data.frame</code>. This would allow you to use different column
names if convenient:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mu</span>, stddev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mu</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_bulk_expr.html">task_create_bulk_expr</a></span><span class="op">(</span><span class="fu">mysim</span><span class="op">(</span><span class="va">mean</span>, <span class="va">stddev</span>, n <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>, <span class="va">pars</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted 5 tasks using 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created bundle 'dentine_gorilla' with 5 tasks</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="more-on-bundles">More on bundles<a class="anchor" aria-label="anchor" href="#more-on-bundles"></a>
</h3>
<p>You can do most things to bundles that you can do to tasks:</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="50%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th>Action</th>
<th>Single task</th>
<th>Bundle</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Get result</td>
<td><code>task_result</code></td>
<td><code>hipercow_bundle_result</code></td>
</tr>
<tr class="even">
<td>Wait for completion</td>
<td><code>task_wait</code></td>
<td><code>hipercow_bundle_wait</code></td>
</tr>
<tr class="odd">
<td>Retry failed tasks (see below)</td>
<td><code>task_retry</code></td>
<td><code>hipercow_bundle_retry</code></td>
</tr>
<tr class="even">
<td>List</td>
<td><code>task_list</code></td>
<td><code>hipercow_bundle_list</code></td>
</tr>
<tr class="odd">
<td>Cancel</td>
<td><code>task_cancel</code></td>
<td><code>hipercow_bundle_cancel</code></td>
</tr>
<tr class="even">
<td>Get log value</td>
<td><code>task_log_value</code></td>
<td><code>hipercow_bundle_log_value</code></td>
</tr>
</tbody>
</table>
<p>There is no equivalent of <code>task_log_watch</code> or
<code>task_log_show</code> because we can’t easily do this for multiple
tasks at the same time in a satisfactory way.</p>
<p><code>hipercow_bundle_delete</code> will delete bundles, but leave
tasks alone. <code>hipercow_purge</code> will delete tasks, causing
actual deletion of data.</p>
<p>Some of these functions naturally have slightly different semantics
to the single-task function; for example,
<code><a href="../reference/hipercow_bundle_result.html">hipercow_bundle_result()</a></code> returns a list of results and
<code>hipewcow_bundle_wait</code> has an option <code>fail_early</code>
to control if it shold return <code>FALSE</code> as soon as any task
fails.</p>
</div>
<div class="section level3">
<h3 id="picking-bundles-back-up-again-later">Picking bundles back up again later<a class="anchor" aria-label="anchor" href="#picking-bundles-back-up-again-later"></a>
</h3>
<p>You can use the <code><a href="../reference/hipercow_bundle_list.html">hipercow_bundle_list()</a></code> function to list
known bundles:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_bundle_list.html">hipercow_bundle_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 name                time</span></span>
<span><span class="co">#&gt; 1    dentine_gorilla 2025-05-13 06:44:42</span></span>
<span><span class="co">#&gt; 2    trainsick_husky 2025-05-13 06:44:42</span></span>
<span><span class="co">#&gt; 3       albinic_bird 2025-05-13 06:44:42</span></span>
<span><span class="co">#&gt; 4      carneous_hoki 2025-05-13 06:44:41</span></span>
<span><span class="co">#&gt; 5 rearmost_chrysalis 2025-05-13 06:44:41</span></span></code></pre></div>
<p>Each bundle has a name (automatically generated by default) and the
time that it was created. If you have launched a bundle and for some
reason lost your session (e.g., Windows update has rebooted your
computer) you can use this to get your ids back.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hipercow_bundle_list.html">hipercow_bundle_list</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">name</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">bundle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hipercow_bundle_load.html">hipercow_bundle_load</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span></code></pre></div>
<p>If you’re not sure what you launched, you can use
<code>task_info</code>:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_info.html">task_info</a></span><span class="op">(</span><span class="va">bundle</span><span class="op">$</span><span class="va">ids</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">task ceb8248f26f931a4410364abc7edcac7 (success)</span> <span style="color: #00BBBB;">─────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Submitted with 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Task type: expression</span></span>
<span><span class="co">#&gt;   • Expression: mysim(mean, stddev, n = 40)</span></span>
<span><span class="co">#&gt;   • Locals: mean and stddev</span></span>
<span><span class="co">#&gt;   • Environment: default</span></span>
<span><span class="co">#&gt;     R_GC_MEM_GROW: 3</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Created at 2025-05-13 06:44:42.936948 (moments ago)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Started at 2025-05-13 06:44:43.000202 (moments ago; waited 64ms)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Finished at 2025-05-13 06:44:43.001414 (moments ago; ran for 2ms)</span></span></code></pre></div>
<p>You can make this process a bit more friendly by setting your own
name into the bundle when creating it using the <code>bundle_name</code>
argument:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mu</span>, stddev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mu</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_bulk_expr.html">task_create_bulk_expr</a></span><span class="op">(</span><span class="fu">mysim</span><span class="op">(</span><span class="va">mean</span>, <span class="va">stddev</span>, n <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>, <span class="va">pars</span>,</span>
<span>                           bundle_name <span class="op">=</span> <span class="st">"final_runs_v2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted 5 tasks using 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created bundle 'final_runs_v2' with 5 tasks</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="making-bundles-from-tasks">Making bundles from tasks<a class="anchor" aria-label="anchor" href="#making-bundles-from-tasks"></a>
</h3>
<p>You can also make a bundle yourself from a group of tasks; this may
be convenient if you need to launch a number of tasks individually for
some reason but want to then consider them together as a group.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">mysim</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted task '4706fa8f2865272df52572f035887d90' using 'example'</span></span>
<span><span class="va">id2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">mysim</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted task 'c8426c7c9a8184552f7154c4d1d8468c' using 'example'</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hipercow_bundle_create.html">hipercow_bundle_create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">id1</span>, <span class="va">id2</span><span class="op">)</span>, <span class="st">"my_new_bundle"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Created bundle 'my_new_bundle' with 2 tasks</span></span>
<span><span class="va">b</span></span>
<span><span class="co">#&gt; → &lt;hipercow_bundle 'my_new_bundle' with 2 tasks&gt;</span></span></code></pre></div>
<p>We can then use this bundle as above:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_bundle_status.html">hipercow_bundle_status</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "success" "success"</span></span>
<span><span class="fu"><a href="../reference/hipercow_bundle_wait.html">hipercow_bundle_wait</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="parallel-tasks">Parallel tasks<a class="anchor" aria-label="anchor" href="#parallel-tasks"></a>
</h2>
<p>So far, the tasks we submitted have been run using a single core on
the cluster, with no special other requests made. Here is a simple
example using two cores; we’ll use <code><a href="../reference/hipercow_resources.html">hipercow_resources()</a></code> to
specify we want two cores on the cluster, and
<code><a href="../reference/hipercow_parallel.html">hipercow_parallel()</a></code> to say that we want to set up two
processes on those cores, using the <code>parallel</code> package. (We
also support <a href="https://future.futureverse.org/" class="external-link"><code>future</code></a>).</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resources</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hipercow_resources.html">hipercow_resources</a></span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span></span>
<span>  <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterApply</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  parallel <span class="op">=</span> <span class="fu"><a href="../reference/hipercow_parallel.html">hipercow_parallel</a></span><span class="op">(</span><span class="st">"parallel"</span><span class="op">)</span>,</span>
<span>  resources <span class="op">=</span> <span class="va">resources</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted task '8354f64f8498b6ceea025cf02d7ac0fe' using 'example'</span></span>
<span><span class="fu"><a href="../reference/task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/task_info.html">task_info</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">task 8354f64f8498b6ceea025cf02d7ac0fe (success)</span> <span style="color: #00BBBB;">─────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Submitted with 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Task type: expression</span></span>
<span><span class="co">#&gt;   • Expression: parallel::clusterApply(NULL, 1:2, function(x) Sys.sleep(5))</span></span>
<span><span class="co">#&gt;   • Locals: (none)</span></span>
<span><span class="co">#&gt;   • Environment: default</span></span>
<span><span class="co">#&gt;     R_GC_MEM_GROW: 3</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Created at 2025-05-13 06:44:43.5703 (moments ago)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Started at 2025-05-13 06:44:43.634053 (moments ago; waited 64ms)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Finished at 2025-05-13 06:44:49.022108 (moments ago; ran for 5.4s)</span></span></code></pre></div>
<p>Both of our parallel tasks are to sleep for 5 seconds. We use
<code><a href="../reference/task_info.html">task_info()</a></code> to report how long it took for those two runs
to execute; if they ran one-by-one, we’d expect around 10 seconds, but
we are seeing a much shorter time than that, so our pair of processes
are running at the same time.</p>
<p>For details on specifying resources and launching different kinds of
parallel tasks, see <code><a href="../articles/parallel.html">vignette("parallel")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="understanding-where-variables-come-from">Understanding where variables come from<a class="anchor" aria-label="anchor" href="#understanding-where-variables-come-from"></a>
</h2>
<p>Suppose our simulation started not from 0, but from some point that
we have computed locally (say <code>x</code>, imaginatively)</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></code></pre></div>
<p>You can use this value to start the simulation by running:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">random_walk</span><span class="op">(</span><span class="va">x</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted task '0df1eb1a4404f3cc9fb8fc250976932f' using 'example'</span></span></code></pre></div>
<p>Here the <code>x</code> value has come from the environment where the
expression passed into <code><a href="../reference/task_create_expr.html">task_create_expr()</a></code> was found
(specifically, we use the <a href="https://rlang.r-lib.org/reference/topic-defuse.html" class="external-link"><code>rlang</code>
“tidy evaluation”</a> framework you might be familiar with from
<code>dplyr</code> and friends).</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/task_result.html">task_result</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 100.7364 101.6134 104.0365 102.2984 101.5219 103.4611 102.2067 101.9490</span></span>
<span><span class="co">#&gt;  [9] 103.0665 105.0759</span></span></code></pre></div>
<p>If you pass in an expression that references a value that does not
exist locally, you will get a (hopefully) informative error message when
the task is created:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">random_walk</span><span class="op">(</span><span class="va">starting_point</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `rlang::env_get_list()`:</span></span>
<span><span class="co">#&gt; ! Can't find `starting_point` in environment.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cancelling-tasks">Cancelling tasks<a class="anchor" aria-label="anchor" href="#cancelling-tasks"></a>
</h2>
<p>You can cancel a task if it has been submitted and not completed,
using <code><a href="../reference/task_cancel.html">task_cancel()</a></code>:</p>
<p>For example, here’s a task that will sleep for 10 seconds, which we
submit to the cluster:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted task 'd452dc28adea4b6400dc20f88137dd07' using 'example'</span></span></code></pre></div>
<p>Having decided that this is a silly idea, we can try and cancel
it:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_cancel.html">task_cancel</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Did not manage to cancel 'd452dc28adea4b6400dc20f88137dd07' which had status 'running'</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="../reference/task_status.html">task_status</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "running"</span></span>
<span><span class="fu"><a href="../reference/task_info.html">task_info</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">task d452dc28adea4b6400dc20f88137dd07 (running)</span> <span style="color: #00BBBB;">─────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Submitted with 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Task type: expression</span></span>
<span><span class="co">#&gt;   • Expression: Sys.sleep(10)</span></span>
<span><span class="co">#&gt;   • Locals: (none)</span></span>
<span><span class="co">#&gt;   • Environment: default</span></span>
<span><span class="co">#&gt;     R_GC_MEM_GROW: 3</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Created at 2025-05-13 06:44:49.994068 (moments ago)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Started at 2025-05-13 06:44:50.057781 (moments ago; waited 64ms)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Not finished yet (running for 55ms)</span></span></code></pre></div>
<p>You can cancel a task that is submitted (waiting to be picked up by a
cluster) or running (though not all drivers will support this; we need
to add this to the example driver still, which will improve this
example!).</p>
<p>You can cancel many tasks at once by passing a vector of identifiers
at the same time. Tasks that have finished (successfully or not) cannot
be cancelled.</p>
</div>
<div class="section level2">
<h2 id="retrying-tasks">Retrying tasks<a class="anchor" aria-label="anchor" href="#retrying-tasks"></a>
</h2>
<p>There are lots of reasons why you might want to retry a task. For
example:</p>
<ul>
<li>it failed but you think it might work next time</li>
<li>you updated a package that it used, and want to try again with the
new version</li>
<li>you don’t like the output from some stochastic function and want to
generate new output</li>
<li>you cancelled the task but want to try again now</li>
</ul>
<p>You can retry tasks with <code><a href="../reference/task_retry.html">task_retry()</a></code>, which is easier
than submitting a new task with the same content, and also preserves a
link between retried tasks.</p>
<p>Our random walk will give slightly different results each time we use
it, so we demonstrate the idea with that:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">random_walk</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted task 'd8f87b0fc46d0e8bd0f9d6494d02b47e' using 'example'</span></span>
<span><span class="fu"><a href="../reference/task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/task_result.html">task_result</a></span><span class="op">(</span><span class="va">id1</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] -0.2010879  0.0110095  1.2169456  2.8090950  2.3301872  2.6869810</span></span>
<span><span class="co">#&gt;  [7]  0.6375382 -0.4393589 -1.3147251  0.7064141</span></span></code></pre></div>
<p>Here we ran a random walk and it got to 0.7064141, which is clearly
not what we were expecting. Let’s try it again:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_retry.html">task_retry</a></span><span class="op">(</span><span class="va">id1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Submitted task '8999f7a829c44ee1ab19a2eccd1f86e3' using 'example'</span></span></code></pre></div>
<p>Running <code><a href="../reference/task_retry.html">task_retry()</a></code> creates a <em>new</em> task, with a
new id <code>8999f7...</code> compared with <code>d8f87b...</code>.</p>
<p>Once this task has finished, we get a different result:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/task_result.html">task_result</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 1.999850 3.305946 3.635446 1.777244 2.375780 1.503801 2.030081 4.746287</span></span>
<span><span class="co">#&gt;  [9] 4.621399 3.748197</span></span></code></pre></div>
<p>Much better!</p>
<p>We get a hint that this is a retried task from the
<code><a href="../reference/task_info.html">task_info()</a></code></p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_info.html">task_info</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">task 8999f7a829c44ee1ab19a2eccd1f86e3 (success)</span> <span style="color: #00BBBB;">─────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Submitted with 'example'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Task type: expression</span></span>
<span><span class="co">#&gt;   • Expression: random_walk(0, 10)</span></span>
<span><span class="co">#&gt;   • Locals: (none)</span></span>
<span><span class="co">#&gt;   • Environment: default</span></span>
<span><span class="co">#&gt;     R_GC_MEM_GROW: 3</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Created at 2025-05-13 06:44:50.185555 (less than a minute ago)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Started at 2025-05-13 06:45:00.370325 (moments ago; waited 10.2s)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Finished at 2025-05-13 06:45:00.371687 (moments ago; ran for 2ms)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Last of a chain of a task retried 1 time</span></span></code></pre></div>
<p>You can see the full chain of retries here:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_info.html">task_info</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span><span class="op">$</span><span class="va">retry_chain</span></span>
<span><span class="co">#&gt; [1] "d8f87b0fc46d0e8bd0f9d6494d02b47e" "8999f7a829c44ee1ab19a2eccd1f86e3"</span></span></code></pre></div>
<p>Once a task has been retried it affects how you interact with the
previous ids; by default they follow through to the most recent element
in the chain:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_result.html">task_result</a></span><span class="op">(</span><span class="va">id1</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 1.999850 3.305946 3.635446 1.777244 2.375780 1.503801 2.030081 4.746287</span></span>
<span><span class="co">#&gt;  [9] 4.621399 3.748197</span></span>
<span><span class="fu"><a href="../reference/task_result.html">task_result</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 1.999850 3.305946 3.635446 1.777244 2.375780 1.503801 2.030081 4.746287</span></span>
<span><span class="co">#&gt;  [9] 4.621399 3.748197</span></span></code></pre></div>
<p>You can get the original result back by passing the argument
<code>follow = FALSE</code>:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/task_result.html">task_result</a></span><span class="op">(</span><span class="va">id1</span>, follow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] -0.2010879  0.0110095  1.2169456  2.8090950  2.3301872  2.6869810</span></span>
<span><span class="co">#&gt;  [7]  0.6375382 -0.4393589 -1.3147251  0.7064141</span></span>
<span><span class="fu"><a href="../reference/task_result.html">task_result</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 1.999850 3.305946 3.635446 1.777244 2.375780 1.503801 2.030081 4.746287</span></span>
<span><span class="co">#&gt;  [9] 4.621399 3.748197</span></span></code></pre></div>
<p>Only tasks that have been completed (<code>success</code>,
<code>failure</code> or <code>cancelled</code>) can be retried, and
doing so adds a new task to the <em>end</em> of the chain; there is no
branching. Retrying the <code>id1</code> here would create the chain
<code>id1 -&gt; id2 -&gt; id3</code>, and following would select
<code>id3</code> for any of the three tasks in the chain.</p>
<p>You cannot currently change any property of a retried task, we may
change this in future.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Paul Liétar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
